<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Preditor de Ações com LSTM</title>
  <!-- Tailwind CSS for styling -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- Google Fonts: Inter -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    /* Custom styles to use the Inter font */
    body {
      font-family: 'Inter', sans-serif;
    }
    /* Simple transition for better UX */
    .transition-all {
      transition: all 0.3s ease-in-out;
    }
  </style>
</head>
<body class="bg-gray-900 text-gray-200 flex items-center justify-center min-h-screen p-4">

  <div class="w-full max-w-3xl mx-auto">
    <!-- Header Section -->
    <header class="text-center mb-10">
      <h1 class="text-4xl md:text-5xl font-bold text-white">Previsão de Ações com <span class="text-cyan-400">LSTM</span></h1>
      <p class="mt-3 text-lg text-gray-400">Modelos otimizados para empresas de tecnologia e IA.</p>
    </header>

    <main class="space-y-8">
      <!-- Prediction Method 1: Ticker and Date -->
      <div class="bg-gray-800 p-6 md:p-8 rounded-2xl shadow-2xl border border-gray-700">
        <h3 class="text-2xl font-semibold text-white mb-6 flex items-center">
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-cyan-400 mr-3"><line x1="12" y1="20" x2="12" y2="10"></line><line x1="18" y1="20" x2="18" y2="4"></line><line x1="6" y1="20" x2="6" y2="16"></line></svg>
          Prever por Ticker e Data
        </h3>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 items-end">
          <!-- Ticker Selection -->
          <div>
            <label for="ticker" class="block mb-2 text-sm font-medium text-gray-300">Escolha a Ação</label>
            <select id="ticker" class="bg-gray-700 border border-gray-600 text-white text-sm rounded-lg focus:ring-cyan-500 focus:border-cyan-500 block w-full p-2.5">
              <option value="AAPL">Apple (AAPL)</option>
              <option value="GOOGL">Google (GOOGL)</option>
              <option value="MSFT">Microsoft (MSFT)</option>
              <option value="AMZN">Amazon (AMZN)</option>
              <option value="META">Meta (META)</option>
            </select>
          </div>
          <!-- Date Selection -->
          <div>
            <label for="data" class="block mb-2 text-sm font-medium text-gray-300">Data da Previsão</label>
            <input type="date" id="data" class="bg-gray-700 border border-gray-600 text-white text-sm rounded-lg focus:ring-cyan-500 focus:border-cyan-500 block w-full p-2.5">
          </div>
        </div>
        <button onclick="prever()" id="botao-prever" class="mt-6 w-full md:w-auto inline-flex items-center justify-center px-6 py-3 border border-transparent text-base font-medium rounded-lg text-white bg-cyan-600 hover:bg-cyan-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-cyan-500 disabled:opacity-50 disabled:cursor-not-allowed transition-all">
          <span class="button-text">Prever Cotação</span>
          <svg class="animate-spin -mr-1 ml-3 h-5 w-5 text-white hidden button-spinner" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
            <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
            <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
          </svg>
        </button>
      </div>

      <!-- Prediction Method 2: CSV Upload -->
      <div class="bg-gray-800 p-6 md:p-8 rounded-2xl shadow-2xl border border-gray-700">
        <h3 class="text-2xl font-semibold text-white mb-2 flex items-center">
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-cyan-400 mr-3"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path><polyline points="14 2 14 8 20 8"></polyline><line x1="16" y1="13" x2="8" y2="13"></line><line x1="16" y1="17" x2="8" y2="17"></line><polyline points="10 9 9 9 8 9"></polyline></svg>
          Ou envie um arquivo CSV
        </h3>
        <p class="text-sm text-gray-400 mb-6">O nome do arquivo deve seguir o padrão: <code class="bg-gray-900 px-1.5 py-1 rounded-md text-cyan-300">TICKER_nome.csv</code></p>
        <div class="flex flex-col sm:flex-row items-center gap-4">
            <label for="csvfile" class="w-full sm:w-auto cursor-pointer inline-flex items-center px-4 py-2 bg-gray-600 hover:bg-gray-700 text-white rounded-lg transition-all">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="mr-2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path><polyline points="17 8 12 3 7 8"></polyline><line x1="12" y1="3" x2="12" y2="15"></line></svg>
                Escolher Arquivo
                <input type="file" id="csvfile" accept=".csv" class="hidden" onchange="updateFileName()">
            </label>
            <span id="file-name" class="text-gray-400 text-sm truncate">Nenhum arquivo selecionado</span>
        </div>
        <button onclick="enviarCSV()" id="botao-csv" class="mt-6 w-full md:w-auto inline-flex items-center justify-center px-6 py-3 border border-transparent text-base font-medium rounded-lg text-white bg-cyan-600 hover:bg-cyan-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-cyan-500 disabled:opacity-50 disabled:cursor-not-allowed transition-all">
          <span class="button-text">Enviar CSV</span>
           <svg class="animate-spin -mr-1 ml-3 h-5 w-5 text-white hidden button-spinner" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
            <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
            <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
          </svg>
        </button>
      </div>

      <!-- Result Section -->
      <div id="resultado-container" class="bg-gray-800 p-6 md:p-8 rounded-2xl shadow-2xl border border-gray-700 hidden">
        <h3 class="text-2xl font-semibold text-white mb-4">Resultado do Modelo</h3>
        <div id="resultado" class="text-lg md:text-xl font-mono"></div>
      </div>
    </main>

  </div>

  <script>
    // Set the default date to today when the page loads
    window.onload = function () {
      const today = new Date().toISOString().split('T')[0];
      document.getElementById("data").value = today;
    };

    // Helper function to manage loading state for buttons
    function setLoading(buttonId, isLoading) {
      const button = document.getElementById(buttonId);
      const buttonText = button.querySelector('.button-text');
      const spinner = button.querySelector('.button-spinner');

      if (isLoading) {
        button.disabled = true;
        buttonText.classList.add('hidden');
        spinner.classList.remove('hidden');
      } else {
        button.disabled = false;
        buttonText.classList.remove('hidden');
        spinner.classList.add('hidden');
      }
    }
    
    // Helper function to display results
    function displayResult(message, isError = false) {
        const resultadoContainer = document.getElementById("resultado-container");
        const resultado = document.getElementById("resultado");
        
        resultado.innerHTML = message;
        resultado.className = isError 
            ? 'text-red-400 text-lg font-mono' 
            : 'text-green-400 text-lg md:text-xl font-mono';
        
        resultadoContainer.classList.remove('hidden');
    }

    // Function to handle prediction via ticker and date
    async function prever() {
      const ticker = document.getElementById("ticker").value;
      const data = document.getElementById("data").value;
      
      setLoading('botao-prever', true);
      displayResult('Processando sua solicitação...', false);

      try {
        // NOTE: This is a placeholder URL. Replace with your actual API endpoint.
        const resposta = await fetch("/api/predict", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ ticker: ticker, target_date: data })
        });

        if (!resposta.ok) {
          const erro = await resposta.json();
          throw new Error(erro.detail || "Ocorreu um erro na predição.");
        }

        const json = await resposta.json();
        const message = `Previsão para <span class="text-cyan-300">${json.prediction_date}</span> | Ticker <span class="text-cyan-300">${json.ticker}</span>: <span class="font-bold text-white">$${json.predicted_close.toFixed(2)}</span>`;
        displayResult(message, false);

      } catch (err) {
        const errorMessage = `Erro: <span class="text-white">${err.message}</span>`;
        displayResult(errorMessage, true);
      } finally {
        setLoading('botao-prever', false);
      }
    }
    
    // Function to update the displayed file name for the CSV input
    function updateFileName() {
        const fileInput = document.getElementById("csvfile");
        const fileNameDisplay = document.getElementById("file-name");
        if (fileInput.files.length > 0) {
            fileNameDisplay.textContent = fileInput.files[0].name;
        } else {
            fileNameDisplay.textContent = "Nenhum arquivo selecionado";
        }
    }

    // Function to handle prediction via CSV file upload
    async function enviarCSV() {
      const fileInput = document.getElementById("csvfile");
      if (fileInput.files.length === 0) {
        displayResult('Erro: <span class="text-white">Por favor, selecione um arquivo CSV primeiro.</span>', true);
        return;
      }
      const file = fileInput.files[0];
      const formData = new FormData();
      formData.append("file", file);

      setLoading('botao-csv', true);
      displayResult('Processando arquivo CSV...', false);

      try {
        // NOTE: This is a placeholder URL. Replace with your actual API endpoint.
        const response = await fetch("/api/predict/from_csv", {
          method: "POST",
          body: formData
        });

        if (!response.ok) {
          const error = await response.json();
          throw new Error(error.detail || "Erro ao processar o arquivo CSV.");
        }

        const json = await response.json();
        const message = `Previsão para <span class="text-cyan-300">${json.prediction_date}</span> | Ticker <span class="text-cyan-300">${json.ticker}</span>: <span class="font-bold text-white">$${json.predicted_close.toFixed(2)}</span>`;
        displayResult(message, false);

      } catch (err) {
        const errorMessage = `Erro: <span class="text-white">${err.message}</span>`;
        displayResult(errorMessage, true);
      } finally {
        setLoading('botao-csv', false);
      }
    }
  </script>

</body>
</html>
